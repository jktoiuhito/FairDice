(()=>{"use strict";class t{constructor(t,e){if(void 0!==e&&"string"!=typeof e)throw new Error("Name must be of type string or undefined");if("string"==typeof e){if(""===e)throw new Error("Name cannot be empty");if(""===e.trim())throw new Error("Name cannot consist only of whitespace")}this._value=t,this._name=null==e?void 0:e.trim()}get value(){return this._value}}class e extends t{constructor(t,e){if(super(t,e),"function"!=typeof t)throw new Error("Value must be of type function");Object.freeze(this)}}class n extends t{constructor(t,e){if(super(t,e),this.isEqual=t=>{if("boolean"!=typeof t)throw new Error("Argument must be of type boolean");if(this._value!==t)throw new Error(void 0!==this._name?`'${this._name}' is not '${t.toString()}'`:`boolean is not '${t.toString()}'`);return this},"boolean"!=typeof t)throw new Error("Value must be of type boolean");Object.freeze(this)}get isTrue(){if(!this._value)throw new Error(void 0!==this._name?`'${this._name}' is not true`:"boolean is not true");return this}get isFalse(){if(this._value)throw new Error(void 0!==this._name?`'${this._name}' is not false`:"boolean is not false");return this}}class r extends t{constructor(t,e){if(super(t,e),this.isGreaterThan=t=>{if("number"!=typeof t)throw new Error("Argument must be of type number");if(!(t<this._value))throw new Error(void 0!==this._name?`'${this._name}' is not greater than '${t.toString()}'`:`number is not greater than '${t.toString()}'`);return this},this.isLessThan=t=>{if("number"!=typeof t)throw new Error("Argument must be of type number");if(!(this._value<t))throw new Error(void 0!==this._name?`'${this._name}' is not less than '${t.toString()}'`:`number is not less than '${t.toString()}'`);return this},"number"!=typeof t)throw new Error("Value must be of type number");Object.freeze(this)}get isSafeInteger(){if(!Number.isSafeInteger(this._value))throw new Error(void 0!==this._name?`'${this._name}' is not a safe integer`:"number is not a safe integer");return this}get isNaN(){if(!Number.isNaN(this._value))throw new Error(void 0!==this._name?`'${this._name}' is not NaN`:"number is not NaN");return this}get isNotNaN(){if(Number.isNaN(this._value))throw new Error(void 0!==this._name?`'${this._name}' is NaN`:"number is NaN");return this}}class s extends t{constructor(t,e){if(super(t,e),this.isMatch=t=>{if(!("object"==typeof t&&t instanceof RegExp))throw new Error("Argument must be of type RegExp");if(!t.test(this._value))throw new Error(void 0!==this._name?`'${this._name}' does not match the regular expression ${t.toString()}`:"string does not match the regular expression "+t.toString());return this},this.isNotMatch=t=>{if(!("object"==typeof t&&t instanceof RegExp))throw new Error("Argument must be of type RegExp");if(t.test(this._value))throw new Error(void 0!==this._name?`'${this._name}' matches the regular expression ${t.toString()}`:"string matches the regular expression "+t.toString());return this},"string"!=typeof t)throw new Error("Value must be of type string");Object.freeze(this)}get isNotEmpty(){if(""===this._value)throw new Error(void 0!==this._name?`String '${this._name}' is empty`:"String is empty");return this}get isEmpty(){if(""!==this._value)throw new Error(void 0!==this._name?`String '${this._name}' is not empty`:"String is not empty");return this}get isNotWhitespace(){if(this._value.length>0&&""===this._value.trim())throw new Error(void 0!==this._name?`String '${this._name}' consists only of whitespace`:"String consists only of whitespace");return this}}class o extends t{constructor(t,e){if(super(t,e),"symbol"!=typeof t)throw new Error("Value must be of type symbol");Object.freeze(this)}}class i extends t{constructor(t,e){if(super(t,e),this.isInstanceOf=t=>{if("function"!=typeof t)throw new Error("Type must be of type function");if(void 0===t.prototype)throw new Error("Type must have a defined prototype");if(!(this._value instanceof t))throw new Error(`Object is not an instance of '${t.name}'`);return this},this.is=t=>{if("object"!=typeof t)throw new Error("Argument must be of type object");if(null===t)throw new Error("Argument cannot be null");if(this._value!==t)throw new Error(void 0!==this._name?`'${this._name}' is not referentially equal to the given object`:"object is not referentially equal to the given object");return this},this.isNot=t=>{if("object"!=typeof t)throw new Error("Argument must be of type object");if(null===t)throw new Error("Argument cannot be null");if(this._value===t)throw new Error(void 0!==this._name?`'${this._name}' is referentially equal to the given object`:"object is referentially equal to the given object");return this},this.isMatch=t=>{if("function"!=typeof t)throw new Error("Predicate must be of type function");if(1!==t.length)throw new Error("Predicate must expect exactly one parameter");const e=t(this._value);if("boolean"!=typeof e)throw new Error("Predicate must return a value of type boolean");if(!e)throw new Error(void 0!==this._name?`'${this._name}' does not match the predicate`:"object does not match the predicate");return this},"object"!=typeof t)throw new Error("Value must be of type object");if(null===t)throw new Error("Value cannot be null");Object.freeze(this)}}class a extends t{constructor(t,e){if(super(t,e),"object"!=typeof t)throw new Error("Value must be of type object");Object.freeze(this)}get isNull(){if(null!==this._value)throw new Error(void 0!==this._name?`'${this._name}' is not null`:"Value is not null");return this}get isNotNull(){if(null===this._value)throw new Error(void 0!==this._name?`'${this._name}' is null`:"Value is null");return new i(this._value,this._name)}}class h extends t{constructor(t,e){if(super(t,e),this.isGreaterThan=t=>{if("bigint"!=typeof t)throw new Error("Argument must be of type bigint");if(!(t<this._value))throw new Error(void 0!==this._name?`'${this._name}' is not greater than '${t.toString()}'`:`bigint is not greater than '${t.toString()}'`);return this},this.isLessThan=t=>{if("bigint"!=typeof t)throw new Error("Argument must be of type bigint");if(!(this._value<t))throw new Error(void 0!==this._name?`'${this._name}' is not less than '${t.toString()}'`:`bigint is not less than '${t.toString()}'`);return this},"bigint"!=typeof t)throw new Error("Value must be of type bigint");Object.freeze(this)}}class l extends t{constructor(t,e){super(t,e),Object.freeze(this)}get isBigint(){if("bigint"!=typeof this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not a bigint`:"Value is not a bigint");return new h(this._value,this._name)}get isBoolean(){if("boolean"!=typeof this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not a boolean`:"Value is not a boolean");return new n(this._value,this._name)}get isFunction(){if("function"!=typeof this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not a function`:"Value is not a function");return new e(this._value,this._name)}get isNumber(){if("number"!=typeof this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not a number`:"Value is not a number");return new r(this._value,this._name)}get isObject(){if("object"!=typeof this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not an object`:"Value is not an object");return new a(this._value,this._name)}get isString(){if("string"!=typeof this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not a string`:"Value is not a string");return new s(this._value,this._name)}get isSymbol(){if("symbol"!=typeof this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not a symbol`:"Value is not a symbol");return new o(this._value,this._name)}get isUndefined(){if(void 0!==this._value)throw new Error(void 0!==this._name?`Value of '${this._name}' is not undefined`:"Value is not undefined");return this}}const u=(t,e)=>new l(t,e);class c{constructor(t,e,n){this.Rolls=u(t).isObject.isNotNull.isInstanceOf(Array).value,this.Previous=e,this.Next=n}}class m{constructor(t,e){if(u(t).isNumber.isNotNaN.isSafeInteger.value<1)throw new Error("'facecount' cannot be under one");if(u(e).isNumber.isNotNaN.isSafeInteger.value<1)throw new Error("'facecount' cannot be under one");if(e>t)throw new Error("'value' cannot be greater than 'facecount'");this.Facecount=t,this.Value=e,Object.freeze(this)}}class d{constructor(){this.onCurrentRollsChange=t=>{this.Listeners.push(u(t).isFunction.value)},this.Roll=t=>{this.CurrentRolls.Rolls.push(new m(t,d.RandomNumber(t))),this.Changed(this.CurrentRolls)},this.Reset=()=>{if(this.CurrentRolls.Rolls.length>0){const t=this.CurrentRolls,e=new c([]);t.Next=e,e.Previous=t,Object.freeze(t),this.History.push(e),this.CurrentRolls=e}this.Changed(this.CurrentRolls)},this.Changed=t=>{this.Listeners.forEach((e=>e(t)))},this.Listeners=[],this.CurrentRolls=new c([]),this.History=[],this.History.push(this.CurrentRolls)}}d.RandomNumber=t=>{if(t<=0)throw new Error("'max' cannot be under one");if(1===t)return 1;const e=new Uint32Array(1),n=Math.pow(2,32)-Math.pow(2,32)%t-1;for(;window.crypto.getRandomValues(e),!(e[0]<=n););return e[0]%t+1};class f extends HTMLTableElement{constructor(t){super(),this.AddRoll=t=>{if(t<=0)throw new Error("value cannot be under one");if(t>this._facecount)throw new Error("value cannot be greater than facecount");this._rolls[t-1]+=1},this.Update=()=>{const t=this.Count;this._countValue.textContent=new Intl.NumberFormat(f.NUMBER_LOCALE).format(t);const e=this.Mean;this._meanValue.textContent=e.toPrecision(this._meanPrecision+1);const n=this.StandardDeviation;if(this._standardDeviationValue.textContent=Math.round(n).toString(),t===this._expectedRollCount){this._countValue.parentElement.className="table-success";const t=Math.abs(e-this._expectedMean);this._meanValue.parentElement.className=t<.001?"table-success":t<.01?"table-warning":"table-danger",this._standardDeviationValue.parentElement.className=n<250?"table-success":n<1e3?"table-warning":"table-danger"}},this.className="table table-bordered",this._facecount=t,this._rolls=new Array(this._facecount).fill(0),this._expectedMean=this._facecount/2+.5,this._meanPrecision=(this._facecount/2).toString().length+3,this._expectedRollCount=E.BENCHMARK_ROUNDS_PER_FACE*t;const e=document.createElement("tr"),n=document.createElement("th"),r=document.createElement("th"),s=document.createElement("th");e.append(n,r,s),n.textContent="D"+t.toString(),r.textContent="Value",s.textContent="Expected";const o=document.createElement("tr"),i=document.createElement("td");this._countValue=document.createElement("td");const a=document.createElement("td");o.append(i,this._countValue,a),i.textContent="Rollcount",this._countValue.textContent="0",a.textContent=new Intl.NumberFormat(f.NUMBER_LOCALE).format(this._expectedRollCount);const h=document.createElement("tr"),l=document.createElement("td");this._meanValue=document.createElement("td");const u=document.createElement("td");h.append(l,this._meanValue,u),l.textContent="${\\bar {x}}_{values}$",this._meanValue.textContent="0",u.textContent=this._expectedMean.toPrecision(this._meanPrecision);const c=document.createElement("tr"),m=document.createElement("td");this._standardDeviationValue=document.createElement("td");const d=document.createElement("td");c.append(m,this._standardDeviationValue,d),m.textContent="$\\sigma_{faces}$",this._standardDeviationValue.textContent="0",d.textContent="0",this.append(e,o,h,c)}get Count(){return this._rolls.reduce(((t,e)=>t+e),0)}get Mean(){let t=0;for(let e=0;e<this._facecount;e++)t+=this._rolls[e]*(e+1);return t/this.Count}get StandardDeviation(){return Math.sqrt(this._rolls.reduce(((t,e)=>t+Math.pow(e-E.BENCHMARK_ROUNDS_PER_FACE,2)),0)/this._facecount)}}f.ELEMENT_NAME="benchmark-result-table",f.NUMBER_LOCALE="en-us",customElements.define(f.ELEMENT_NAME,f,{extends:"table"});class _{constructor(){this._isCancelled=!1}get isCancelled(){return this._isCancelled}set isCancelled(t){this._isCancelled=t}}class w extends HTMLButtonElement{constructor(t){super(),this.Facecount=t,this._rollcount=0,this.type="button",this.className="btn btn-primary m-2",this.style.width="4em",this._rollcountElement=document.createElement("p"),this._rollcountElement.className="m-0 p-0 badge",this._rollcountElement.textContent=this._rollcount.toString();const e=document.createElement("p");e.className="m-0 p-0",e.textContent="D"+this.Facecount.toString(),this.append(this._rollcountElement,e)}set Rollcount(t){if(t<0)throw new Error("'rollcount' cannot be under one");this._rollcount=t,this._rollcountElement.removeChild(this._rollcountElement.firstChild),this._rollcountElement.textContent=this._rollcount.toString()}}w.ElementName="dice-button",customElements.define(w.ElementName,w,{extends:"button"});class E{constructor(t){this.DisplayCurrentRolls=t=>{for(this.CurrentRolls=t;null!==this.ResultsContainer.firstChild;)this.ResultsContainer.removeChild(this.ResultsContainer.firstChild);let e=0;t.Rolls.forEach((t=>{e+=t.Value;const n=document.createElement("div");n.className="card m-1",n.style.width="4em",n.style.height="4em";const r=document.createElement("h5");r.className="badge text-muted",r.textContent="d"+t.Facecount.toString(),n.appendChild(r);const s=document.createElement("span");s.textContent=t.Value.toString(),n.appendChild(s),this.ResultsContainer.appendChild(n)})),this.ScoreCounter.removeChild(this.ScoreCounter.firstChild),this.ScoreCounter.textContent=e.toString(),this.Dice.forEach((t=>t.Rollcount=this.CurrentRolls.Rolls.filter((e=>e.Facecount===t.Facecount)).length)),this.NewRollButton.disabled=t.Rolls.length<=0,this.PreviousButton.disabled=void 0===t.Previous,this.NextButton.disabled=void 0===t.Next},this.GetElementById=t=>u(document.getElementById(t),t).isObject.isNotNull.isInstanceOf(HTMLElement).value,this.RunBenchmark=()=>{E.DICE.forEach(((t,e)=>{const n=new f(t);this.BenchmarkModalResultsContainer.appendChild(n);const r=E.BENCHMARK_ROUNDS_PER_FACE*t,s=()=>{let o=1e3;for(;o-- >0&&n.Count<r;)n.AddRoll(d.RandomNumber(t));n.Update(),this.BenchmarkCancellationToken.isCancelled||(n.Count<r?window.setTimeout((()=>s()),E.BENCHMARK_TIMEOUT):e===E.DICE.length-1&&(this.BenchmarkStartButton.hidden=!1,this.BenchmarkStopButton.hidden=!0))};s()})),MathJax.typeset()},this.DiceContainer=this.GetElementById("dice-container"),this.ResultsContainer=this.GetElementById("results-container"),this.ScoreCounter=this.GetElementById("results-score-counter");const e=this.GetElementById("controls-container");this.PreviousButton=this.GetElementById("controls-button-previous"),this.NextButton=this.GetElementById("controls-button-next"),this.NewRollButton=this.GetElementById("controls-button-new");const n=this.GetElementById("button-benchmark"),r=this.GetElementById("benchmark-modal");this.BenchmarkStartButton=this.GetElementById("benchmark-run-button"),this.BenchmarkStopButton=this.GetElementById("benchmark-stop-button"),this.BenchmarkModalResultsContainer=this.GetElementById("benchmark-modal-results-container"),this.Dice=[],E.DICE.forEach((e=>{const n=new w(e);n.addEventListener("click",(()=>{t.Roll(e)})),this.DiceContainer.appendChild(n),this.Dice.push(n)})),t.onCurrentRollsChange(this.DisplayCurrentRolls),this.PreviousButton.addEventListener("click",(()=>{this.DisplayCurrentRolls(this.CurrentRolls.Previous)})),this.NextButton.addEventListener("click",(()=>{this.DisplayCurrentRolls(this.CurrentRolls.Next)})),this.NewRollButton.addEventListener("click",(()=>{t.Reset()})),this.BenchmarkStartButton.addEventListener("click",(()=>{for(;null!==this.BenchmarkModalResultsContainer.firstChild;)this.BenchmarkModalResultsContainer.removeChild(this.BenchmarkModalResultsContainer.firstChild);this.BenchmarkCancellationToken.isCancelled=!1,this.RunBenchmark(),this.BenchmarkStartButton.hidden=!0,this.BenchmarkStopButton.hidden=!1})),this.BenchmarkStopButton.addEventListener("click",(()=>{this.BenchmarkCancellationToken.isCancelled=!0,this.BenchmarkStartButton.hidden=!1,this.BenchmarkStopButton.hidden=!0})),this.CurrentRolls=new c([]),this.BenchmarkCancellationToken=new _,this.DisplayCurrentRolls(this.CurrentRolls),this.DiceContainer.hidden=!1,this.ResultsContainer.hidden=!1,e.hidden=!1,n.hidden=!1,this.ScoreCounter.hidden=!1,r.hidden=!1,document.querySelector("hr").hidden=!1}}E.BENCHMARK_ROUNDS_PER_FACE=1e5,E.DICE=[4,6,8,10,12,20,100],E.BENCHMARK_TIMEOUT=25,window.addEventListener("load",(()=>{try{new E(new d)}catch(t){throw document.getElementById("apple-error").hidden=!1,t}}))})();